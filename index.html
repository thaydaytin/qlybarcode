<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
</head>
<body>
<script>
async function run() {
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    if (!id) {
        document.body.innerHTML = "<h2>Thiếu tham số id</h2>";
        return;
    }

    const sheetID = "1FGKzqES1frfpqBJJySkFFd5nlQ6voXHYiQJvp-5stm0";

    const apiURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;

    try {
        const response = await fetch(apiURL);
        let text = await response.text();

        text = text.substr(47).slice(0, -2);
        const data = JSON.parse(text);

        const rows = data.table.rows;

        const found = rows.find(row => row.c[0]?.v === id);

        if (found) {
            const redirectURL = found.c[1].v;
            window.location.href = redirectURL;
        } else {
            document.body.innerHTML = "<h3>ID không tồn tại!</h3>";
        }

    } catch (e) {
        document.body.innerHTML = "<h3>Lỗi tải dữ liệu!</h3>";
        console.error(e);
    }
}

run();
</script>
</body>
</html>
